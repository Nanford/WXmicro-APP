
## **小程序技术开发文档：AI彩虹之间**

**版本:** V1.0-Dev  
**日期:** 2026年1月7日  
**开发平台:** 微信小程序  
**设计基准:** 750rpx宽度（iPhone 6/7/8标准）

---

### **技术架构与基础规范**

整个小程序采用微信原生框架开发，主要使用WXML、WXSS和JavaScript构建。设计基准宽度为750rpx，这意味着设计稿中的1px等于1rpx。所有页面需要适配不同机型，关键元素采用flex布局确保兼容性。

全局样式变量需要统一定义，主色调采用渐变蓝紫色（#6B5FE8到#9B8FF5），辅助色使用浅粉色（#FFE4E9），背景色为柔和的浅灰（#F8F9FC）。字体大小遵循标准层级：标题使用32rpx（加粗），正文使用28rpx，辅助信息使用24rpx，所有文字颜色主要使用#333333，次要文字使用#999999。

全局需要实现的通用组件包括顶部导航栏（高度88rpx，包含返回按钮和页面标题）、底部TabBar（高度100rpx，包含四个Tab图标和文字）、加载动画组件、toast提示组件、模态对话框组件。这些组件需要统一封装，方便各页面复用。

---

### **数据存储与状态管理**

本地存储使用微信的wx.setStorageSync和wx.getStorageSync实现，需要存储的关键数据包括用户登录态token（有效期7天）、用户基本信息（昵称、头像、会员状态）、对话历史记录（限制最近100条）、情绪日历数据（最近90天）。所有敏感数据需要加密存储。

全局状态管理建议使用单例模式的globalData存储当前用户信息、会员状态、未读消息数量等。需要实现一个统一的状态更新机制，当用户信息变更时能够通知所有相关页面刷新。

---

### **页面详细设计规范**

**首页（pages/index/index）**

首页整体采用纵向滚动布局，顶部不需要导航栏。页面顶部距离屏幕顶端80rpx处开始展示个性化问候语，使用32rpx加粗字体，颜色为#333333。问候语根据当前时间动态变化：6点到12点显示"早上好"，12点到18点显示"下午好"，18点之后显示"晚上好"。

问候语下方60rpx处是AI形象展示区，这个区域高度为400rpx，宽度为690rpx（左右各留30rpx边距），背景使用渐变色卡片，圆角为24rpx。卡片内部居中放置AI形象插画（建议尺寸200rpx×200rpx），插画下方40rpx处放置"去聊聊"按钮。按钮宽度为240rpx，高度为72rpx，圆角为36rpx，背景色使用主色调渐变，文字为白色28rpx。

AI形象卡片下方40rpx处开始是内容推荐区，这里需要展示三张横向卡片，每张卡片高度为200rpx，宽度为690rpx，卡片之间间距为24rpx。每张卡片采用白色背景，圆角16rpx，内部左侧60rpx处放置一个小型插图（尺寸120rpx×120rpx），右侧留出480rpx宽度用于展示内容。

内容区域顶部是标题，使用30rpx加粗字体，颜色#333333。标题下方12rpx是简介文字，使用24rpx常规字体，颜色#666666，最多显示两行，超出部分用省略号代替。卡片右下角距离底部20rpx、右边20rpx处放置操作按钮，按钮宽度为140rpx，高度为56rpx，圆角28rpx，边框1rpx实线，使用主色调，文字颜色也是主色调，字号24rpx。

三张推荐卡片分别对应成长学习社、使用指南、实用资料包。点击任一卡片的操作按钮后，需要调用wx.navigateTo跳转到对应详情页，同时传递对应的内容ID参数。

页面底部需要预留100rpx的安全区域，避免被TabBar遮挡。整个首页需要实现下拉刷新功能，刷新时重新加载推荐内容。

**日历页（pages/calendar/calendar）**

日历页顶部是固定导航栏，高度88rpx，显示"情绪日历"标题。导航栏下方是视图切换区，高度为80rpx，包含两个切换按钮"日视图"和"月视图"，按钮宽度各为200rpx，采用分段控件样式，选中状态使用主色调背景，未选中状态为透明背景。

日视图模式下，主要展示当天的情绪状态。如果当天未记录，页面中央垂直居中显示一个提示卡片，卡片宽度为600rpx，高度为400rpx，圆角为24rpx，白色背景，内部居中显示提示图标（尺寸120rpx×120rpx）和文字"今天的情绪日历还没解锁哦"（28rpx，#666666），文字下方60rpx处是"去成长"按钮，样式同首页的主要按钮。

如果当天已记录，则展示情绪详情卡片，包含情绪类型图标、情绪描述文字、记录时间。卡片可以左右滑动切换到前后几天的记录。

月视图模式下，展示完整的日历网格。日历网格从视图切换区下方30rpx开始，高度约为600rpx。日历采用7列布局（周一到周日），每个日期单元格宽度为100rpx，高度为90rpx。单元格内顶部显示日期数字（28rpx），下方显示情绪标记点（如果有记录的话，直径12rpx的彩色圆点，不同情绪对应不同颜色）。

当前月份之外的日期显示为浅灰色（#CCCCCC），不可点击。有记录的日期可以点击查看详情，点击后弹出底部抽屉，抽屉高度为60%屏幕高度，展示该日的完整情绪记录。

月视图下方是情绪趋势图表区域，从日历网格底部60rpx开始，高度为300rpx。这里需要集成一个简单的折线图组件，横轴显示日期，纵轴显示情绪值（可以用1-10的量化值）。图表使用Canvas绘制，线条颜色使用主色调渐变。

**测评页（pages/assessment/assessment）**

测评页采用纵向滚动列表布局。顶部是固定导航栏显示"心理测评"标题。导航栏下方可以添加一个筛选栏，高度为88rpx，包含几个分类标签如"全部"、"情绪管理"、"人际关系"、"亲子教育"等，标签可以横向滚动。

测评列表从筛选栏下方30rpx开始，每个测评项是一张卡片，高度为260rpx，宽度为690rpx（左右各留30rpx边距），卡片之间间距为24rpx。卡片采用白色背景，圆角16rpx，带有轻微阴影（shadow: 0 4rpx 12rpx rgba(0,0,0,0.08)）。

卡片内部布局：左上角是测评封面图（尺寸180rpx×180rpx，圆角12rpx），封面图右侧留出480rpx宽度展示信息。顶部是测评标题（30rpx加粗，#333333），标题下方12rpx是简介（24rpx，#666666，最多三行）。卡片底部区域显示价格、参与人数信息，价格使用32rpx加粗红色（#FF4D4F），"¥"符号使用24rpx。参与人数显示在价格右侧，使用24rpx灰色文字。

卡片右下角是"立即测评"按钮，宽度为160rpx，高度为60rpx，样式同首页按钮。点击卡片或按钮都应跳转到测评详情页。

列表需要实现上拉加载更多功能，当滚动到底部时自动加载下一页数据。加载时底部显示加载动画，加载完成后显示"已加载全部"提示。

**我的页面（pages/profile/profile）**

我的页面顶部是用户信息卡片，高度为280rpx。这个卡片采用渐变背景，从顶部的主色调渐变到底部稍深的颜色。卡片内部距离顶部40rpx处居中显示用户头像，头像尺寸为120rpx×120rpx，圆形裁剪。头像下方24rpx是用户昵称（32rpx，白色，加粗），昵称右侧可以显示一个小的会员标识（如果是会员的话）。昵称下方12rpx显示会员状态文字，如"VIP有效期至2026-12-31"或"未开通会员"，使用24rpx白色半透明文字。

用户信息卡片下方紧接着是VIP推广横幅，高度为120rpx，宽度为690rpx（左右各留30rpx边距），圆角16rpx，使用渐变金色背景。横幅左侧显示推广文案"开通VIP，智慧每日相伴"（28rpx，深金色），右侧是"立即续费"按钮（宽度140rpx，高度56rpx，白色背景，深金色文字）。

VIP横幅下方30rpx开始是功能菜单列表。每个菜单项高度为100rpx，宽度为690rpx，白色背景，上下菜单项之间有1rpx的分割线（#EEEEEE）。菜单项内部左侧预留80rpx用于放置功能图标（尺寸48rpx×48rpx），图标右侧24rpx是功能名称（30rpx，#333333），菜单项右侧预留60rpx用于显示右箭头指示符（使用小程序原生icon组件）。

功能菜单包含的项目依次是：我的收藏、我的测评、兑换中心、联系客服、修改昵称、退出登录。其中"联系客服"点击后弹出模态框显示企业微信二维码图片（400rpx×400rpx），"修改昵称"点击后弹出输入框，"退出登录"点击后显示确认对话框。

**登录注册页（pages/login/login）**

登录页采用居中布局设计。页面顶部距离屏幕顶端200rpx处显示产品Logo或插画（尺寸200rpx×200rpx）。Logo下方60rpx是欢迎文案"欢迎进入「AI彩虹之间」的对话空间"，使用32rpx加粗字体，居中显示，可以分两行。

文案下方100rpx处是主要登录按钮"微信一键登录"，按钮宽度为600rpx，高度为88rpx，圆角44rpx，使用微信绿色背景（#07C160），白色文字32rpx。按钮需要使用微信官方的button组件并设置open-type="getPhoneNumber"来获取手机号授权。

主按钮下方40rpx是"暂不登录"次要按钮，样式为透明背景，灰色文字（28rpx），点击后可以游客模式进入。

页面底部距离屏幕底端60rpx处显示协议同意区域。这里使用一个checkbox组件（尺寸32rpx×32rpx）配合文字"我已阅读并同意"，文字右侧是可点击的《用户协议》和《隐私政策》链接（使用主色调），点击跳转到对应的协议页面。登录按钮只有在勾选协议后才可点击。

**对话页（pages/chat/chat）**

对话页是核心交互页面，布局比较复杂。顶部是自定义导航栏，高度88rpx，左侧显示返回按钮，中间显示"AI对话"标题，右侧可以放置分享按钮。

导航栏下方是消息列表区域，这个区域高度为屏幕可用高度减去导航栏和输入框的高度。消息列表采用scroll-view组件实现，支持纵向滚动，新消息到达时自动滚动到底部。

消息气泡分为用户消息和AI消息两种样式。用户消息靠右对齐，气泡最大宽度为540rpx，背景色使用主色调渐变，白色文字28rpx，圆角24rpx，左上角和左下角为24rpx圆角，右上角为4rpx小圆角，右下角为24rpx圆角。用户消息距离右侧30rpx。

AI消息靠左对齐，气泡最大宽度为540rpx，白色背景，黑色文字28rpx，圆角设置与用户消息相反（右上角和右下角为24rpx，左上角为4rpx，左下角为24rpx）。AI消息距离左侧30rpx。AI消息左侧需要显示一个小型AI头像（尺寸64rpx×64rpx，圆形）。

消息之间的间距为24rpx。每条消息下方可以显示发送时间（仅在相邻两条消息时间差超过5分钟时显示），时间使用24rpx灰色居中显示。

消息列表底部是输入区域，这个区域固定在页面底部，高度为100rpx（未展开状态）。输入区域背景为白色，顶部有1rpx分割线（#EEEEEE）。输入框宽度为570rpx，高度为64rpx，左侧距离边距30rpx，右侧预留150rpx放置发送按钮。输入框采用textarea组件，最多支持4行，超出自动滚动。

发送按钮宽度为120rpx，高度为64rpx，圆角32rpx。当输入框有内容时，按钮背景使用主色调渐变，白色文字"发送"；输入框无内容时，按钮显示为灰色禁用状态。

输入框左侧可以放置一个语音输入切换按钮（宽度64rpx，高度64rpx），点击后输入框变为"按住说话"的录音按钮。

AI回复消息时需要展示打字动画效果，可以通过逐字显示内容来实现，每个字的显示间隔约50ms。

**内容详情页（pages/detail/detail）**

内容详情页采用统一的模板设计，可以根据内容类型（测评、学习营、指南、资料包）动态渲染不同内容。

页面顶部是一个大型封面图区域，高度为420rpx，宽度全屏（750rpx），图片需要设置mode="aspectFill"确保填充满整个区域。封面图上方叠加显示返回按钮（位于左上角距离边缘20rpx处，半透明黑色背景，白色图标）。

封面图下方是内容主体区域。首先是标题栏，高度约为100rpx，标题使用36rpx加粗字体，左右各留30rpx边距。标题下方12rpx是副标题或标签，使用24rpx灰色文字。

标题栏下方是价格/参与信息栏（如果是付费内容），高度80rpx。价格使用40rpx加粗红色显示，价格右侧显示原价（24rpx灰色，带删除线）和参与人数。

信息栏下方30rpx开始是详细介绍区域，这部分采用rich-text组件渲染富文本内容，包括图片、文字段落等。富文本内容左右各留30rpx边距，段落间距为30rpx，图片宽度为690rpx自适应高度。

页面底部固定一个操作栏，高度为100rpx，白色背景，顶部有阴影效果。操作栏内部居中显示主要操作按钮，按钮宽度为690rpx，高度为80rpx，圆角40rpx，使用主色调渐变背景，白色文字32rpx加粗。按钮文字根据内容类型显示"立即购买"、"立即参加"或"立即领取"。

点击操作按钮后，如果是付费内容需要调用wx.requestPayment发起微信支付，支付成功后跳转到对应的内容页面或解锁状态。

---

### **接口设计与数据交互**

所有接口请求需要统一封装在utils/request.js中，包含请求拦截、响应拦截、错误处理。请求头需要携带token（存储在storage中的登录态），格式为"Authorization: Bearer {token}"。

主要接口包括：用户登录接口（POST /api/auth/login，传递code和encryptedData获取token和用户信息）、获取首页推荐内容（GET /api/home/recommend）、获取测评列表（GET /api/assessment/list，支持分页参数page和size）、购买测评（POST /api/assessment/purchase，传递assessment_id）、发送AI消息（POST /api/chat/send，传递message内容，返回AI回复）、获取对话历史（GET /api/chat/history）、保存情绪记录（POST /api/calendar/emotion，传递date和emotion_data）、获取情绪记录（GET /api/calendar/emotion，传递start_date和end_date）、获取用户信息（GET /api/user/profile）、更新用户昵称（POST /api/user/update_nickname）。

所有列表接口需要支持分页，返回格式统一为：{code: 200, message: "success", data: {list: [], total: 0, page: 1, size: 10}}。接口错误时返回code非200的响应，message字段包含错误描述，前端需要通过toast提示用户。

对话接口需要支持流式返回或长轮询，建议使用WebSocket实现实时通信，连接地址为wss://your-domain.com/api/chat/ws，连接成功后发送认证消息，之后可以双向通信。消息格式为JSON：{type: "message", content: "用户输入", timestamp: 1234567890}，AI回复格式类似。

---

### **性能优化与用户体验**

图片资源需要采用webp格式减小体积，所有图片都应该上传到CDN并设置懒加载。列表页的图片可以使用小程序的lazy-load属性，只有滚动到可视区域才加载。

对话页的消息列表需要实现虚拟列表，当消息数量超过50条时，只渲染可视区域附近的消息节点，避免页面卡顿。可以使用recycle-view组件或自己实现虚拟滚动逻辑。

所有关键数据需要做本地缓存，首次进入页面时先展示缓存数据，然后异步请求最新数据刷新界面。这样可以让用户感觉页面打开很快。

网络请求失败时需要有友好的错误提示和重试机制，可以在页面底部显示一个"网络异常，点击重试"的提示条，点击后重新发起请求。

支付流程需要有完整的状态处理：支付中（显示loading）、支付成功（toast提示并跳转）、支付失败（toast提示并允许重试）、用户取消支付（关闭支付面板，不做提示）。

页面切换动画使用微信默认的右滑进入效果，特殊页面如弹窗类详情页可以使用底部向上滑入效果（navigateTo时配置animationType）。

所有输入框需要监听键盘弹起和收起事件，自动调整页面布局避免被键盘遮挡。对话页需要在键盘弹起时自动滚动到最底部。

---

### **权限与安全控制**

小程序需要在app.json中声明所需的权限，包括scope.userInfo（用户信息）、scope.userLocation（如果需要定位推荐）。获取手机号需要使用button的open-type="getPhoneNumber"并在后端验证。

敏感数据如token需要加密存储，可以使用简单的base64编码或更安全的加密算法。用户退出登录时需要清除所有本地缓存的用户数据。

支付前需要验证订单的有效性，后端需要再次校验价格和商品信息，避免前端篡改。支付成功后需要轮询订单状态或使用支付回调接口确认支付结果。

所有用户输入的内容都需要做前端校验和后端二次校验，防止恶意输入。对话内容需要过滤敏感词，可以在发送前调用内容安全接口检测。

---

### **测试要点与发布准备**

开发完成后需要在多个真机上测试，重点测试iOS和Android的兼容性，特别是刘海屏、全面屏的适配。需要测试不同网络环境下的表现，包括弱网、断网情况。

需要准备小程序的各种资质材料：营业执照、ICP备案、支付商户号、内容审核资质（因为涉及AI对话内容）。如果涉及心理健康相关服务，可能需要额外的行业资质。

小程序的隐私政策和用户协议需要由法务团队审核，确保合规。需要在管理后台配置隐私接口调用说明，说明获取手机号、用户信息等隐私数据的用途。

提交审核前需要准备详细的功能说明和测试账号，让审核人员能够完整体验所有功能。如果首次被拒，需要根据反馈意见进行修改后重新提交。

小程序正式发布后需要持续监控错误日志和用户反馈，使用微信小程序后台的数据分析工具跟踪关键指标如PV、UV、留存率、转化率等。根据数据反馈持续优化产品体验。

