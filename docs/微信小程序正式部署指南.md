# 微信小程序正式部署指南

## 📋 部署前准备清单

### 您的配置信息
- **AppID**: `wxd27720368e06ab67`
- **AppSecret**: `5f36b50ef64cf34cdfd079d31d884997`（⚠️ 请妥善保管，不要泄露）
- **服务器域名**: `hcmai.szhlsn.cn`

---

## 🚀 第一步：微信公众平台配置

### 1.1 登录微信公众平台
1. 打开 [微信公众平台](https://mp.weixin.qq.com/)
2. 使用管理员微信扫码登录

### 1.2 配置服务器域名（重要！）
1. 进入 **开发管理** → **开发设置**
2. 找到 **服务器域名** 部分，点击 **开始配置** 或 **修改**
3. 扫码验证管理员身份
4. 添加以下域名：

| 类型 | 域名 |
|------|------|
| **request 合法域名** | `https://hcm.hootoolai.com` |
| **uploadFile 合法域名** | `https://hcm.hootoolai.com` |
| **downloadFile 合法域名** | `https://hcm.hootoolai.com` |

> ⚠️ **注意事项**：
> - 域名必须是 `https://` 协议
> - 域名不能带端口号
> - 确保服务器已部署 SSL 证书
> - 域名需要 ICP 备案

### 1.3 配置业务域名（可选，用于 web-view）
如果小程序内需要嵌入网页，需要在 **业务域名** 中添加相应域名。

---

## 🔧 第二步：确认项目配置

### 2.1 检查 `project.config.json`
确保 AppID 正确：
```json
{
  "appid": "wxfad3c48ef31755f8"
}
```
✅ 已确认正确

### 2.2 检查 `utils/config.js`
确保环境设置为生产环境：
```javascript
const ENV = 'production';
```
✅ 已确认正确

### 2.3 关闭开发工具的域名校验
在正式上传前，需要在 `project.config.json` 中将 `urlCheck` 设置为 `true`：
```json
{
  "setting": {
    "urlCheck": true  // 正式版需要设为 true
  }
}
```

---

## 📤 第三步：上传代码

### 3.1 在微信开发者工具中上传
1. 打开 **微信开发者工具**
2. 确保项目已加载且 AppID 正确
3. 点击右上角的 **上传** 按钮
4. 填写版本信息：
   - **版本号**: 如 `1.0.0`（首次可填 `1.0.0`）
   - **项目备注**: 填写本次更新的内容说明

5. 点击 **确定** 完成上传

### 3.2 上传成功后
代码将出现在 **微信公众平台** → **管理** → **版本管理** → **开发版本** 中

---

## 🧪 第四步：体验版测试

### 4.1 设置体验版
1. 在 **版本管理** 中找到刚上传的开发版本
2. 点击 **设为体验版**
3. 会生成一个体验版二维码

### 4.2 添加体验成员
1. 进入 **成员管理**
2. 添加体验成员（需要微信号）
3. 体验成员可以扫码测试

### 4.3 测试要点
- [ ] 后端 API 是否正常连接
- [ ] AI 对话功能是否正常
- [ ] 登录功能是否正常
- [ ] 页面加载是否正常
- [ ] 图片资源是否正常显示

---

## ✅ 第五步：提交审核

### 5.1 提交审核
1. 在开发版本中点击 **提交审核**
2. 填写审核信息：
   - **版本描述**: 详细描述小程序功能
   - **测试账号**: 如果需要登录测试，提供测试账号
   - **类目选择**: 选择正确的小程序类目

### 5.2 审核要求
- 小程序功能完整，无明显 bug
- 页面内容符合微信规范
- 不涉及敏感内容
- 隐私协议完整（如需要）

### 5.3 审核时间
- 通常 1-7 个工作日
- 加急审核约 2 小时（需满足条件）

---

## 🎉 第六步：发布上线

### 6.1 审核通过后
1. 在 **版本管理** → **审核版本** 中查看
2. 点击 **发布**（或 **全量发布**）
3. 小程序正式上线！

### 6.2 发布选项
- **全量发布**: 所有用户立即可用
- **分阶段发布**: 逐步覆盖用户（可选）

---

## 🔒 安全提醒

1. **AppSecret 安全**
   - 永远不要在前端代码中使用 AppSecret
   - AppSecret 只能在后端服务器使用
   - 定期更换 AppSecret

2. **域名安全**
   - 确保服务器 SSL 证书有效
   - 定期检查域名续费

3. **代码安全**
   - 不要在代码中暴露敏感信息
   - 使用环境变量管理密钥

---

## ❓ 常见问题

### Q: 域名配置后仍然报错？
A: 
1. 确认域名已添加到服务器域名列表
2. 确认域名格式正确（带 https://，不带端口）
3. 等待 5-10 分钟让配置生效
4. 重启微信开发者工具

### Q: 审核被拒怎么办？
A: 
1. 阅读拒绝原因
2. 修改对应问题
3. 重新上传并提交审核

### Q: 如何更新已发布的小程序？
A: 
1. 修改代码后重新上传（版本号递增）
2. 再次提交审核
3. 审核通过后发布

---

## 📞 快速操作链接

- [微信公众平台](https://mp.weixin.qq.com/)
- [小程序文档](https://developers.weixin.qq.com/miniprogram/dev/framework/)
- [审核规范](https://developers.weixin.qq.com/miniprogram/product/reject.html)
